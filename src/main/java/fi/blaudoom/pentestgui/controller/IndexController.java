package fi.blaudoom.pentestgui.controller;

import fi.blaudoom.pentestgui.GlobalState;
import fi.blaudoom.pentestgui.service.project.ProjectService;
import fi.blaudoom.pentestgui.service.project.TargetAccessService;
import fi.blaudoom.pentestgui.service.user.UserService;
import org.springframework.data.crossstore.ChangeSetPersister;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestParam;

@Controller
public class IndexController {

    private final TargetAccessService targetAccessService;
    private final ProjectService projectService;

    private final GlobalState globalState;

    public IndexController(UserService userService, TargetAccessService targetAccessService, ProjectService projectService, GlobalState globalState) {
        this.targetAccessService = targetAccessService;
        this.projectService = projectService;
        this.globalState = globalState;
    }

    @GetMapping("/report")
    public String index(Model model, @RequestParam Long id) throws ChangeSetPersister.NotFoundException {
        model.addAttribute("project", projectService.getFullProject(globalState.getCurrentProject()));
        model.addAttribute("target", targetAccessService.getTargetById(id));
        return "report";
    }
}
