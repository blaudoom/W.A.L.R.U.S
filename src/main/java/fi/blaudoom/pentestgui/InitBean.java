package fi.blaudoom.pentestgui;

import fi.blaudoom.pentestgui.dao.ProjectRepository;
import fi.blaudoom.pentestgui.model.Project;
import jakarta.annotation.PostConstruct;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Scope;
import org.springframework.core.env.Environment;
import org.springframework.stereotype.Component;

@Component
public class InitBean {

    private final ProjectRepository projectRepository;
    private final GlobalState globalState;


    private final Environment environment;

    public InitBean(ProjectRepository projectRepository, GlobalState globalState, Environment environment) {
        this.projectRepository = projectRepository;
        this.globalState = globalState;
        this.environment = environment;
    }

    @PostConstruct
    public void init() {
        if(!projectRepository.findAll().iterator().hasNext()){
            Project project = new Project();
            project.setName("Default Project");
            project = projectRepository.save(project);
            globalState.setCurrentProject(project.getId());
        } else if (projectRepository.findAll().iterator().hasNext()) {
            globalState.setCurrentProject(projectRepository.findAll().iterator().next().getId());

        }
    }

}
