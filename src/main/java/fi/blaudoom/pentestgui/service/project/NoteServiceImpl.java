package fi.blaudoom.pentestgui.service.project;

import fi.blaudoom.pentestgui.dao.ServiceNoteRepository;
import fi.blaudoom.pentestgui.dao.TargetServiceRepository;
import fi.blaudoom.pentestgui.model.ServiceNote;
import fi.blaudoom.pentestgui.model.TargetService;
import fi.blaudoom.pentestgui.service.project.dto.NoteSaveDto;
import jakarta.transaction.Transactional;
import org.springframework.stereotype.Service;

@Service
public class NoteServiceImpl implements NoteService {
    private final ServiceNoteRepository serviceNoteRepository;
    private final TargetServiceRepository targetServiceRepository;

    public NoteServiceImpl(ServiceNoteRepository serviceNoteRepository, TargetServiceRepository targetServiceRepository) {
        this.serviceNoteRepository = serviceNoteRepository;
        this.targetServiceRepository = targetServiceRepository;
    }

    @Override
    @Transactional
    public boolean saveNoteForService(NoteSaveDto dto) {
        TargetService service = targetServiceRepository.findById(dto.getServiceId()).orElse(null);
        if (service == null) {
            return false;
        }else {
            serviceNoteRepository.save(new ServiceNote(
                    service,
                    dto.getContent(),
                    dto.getTitle()
            ));
            return true;
        }
    }
}
